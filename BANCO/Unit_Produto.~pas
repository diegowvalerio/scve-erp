unit Unit_Produto;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, Buttons, ExtCtrls, Grids, DBGrids, ComCtrls, DB,
  IBCustomDataSet, Mask, DBCtrls, IBDatabase, IBSQL, ExtDlgs, QuickRpt,
Jpeg;

type
  TForm_Produto = class(TForm)
    PageControl1: TPageControl;
    Tab_Pesquisa: TTabSheet;
    Tab_Cadastro: TTabSheet;
    Rg_tipo: TRadioGroup;
    GroupBox1: TGroupBox;
    Edit1: TEdit;
    btn_comfirmar: TBitBtn;
    btn_cancelar: TBitBtn;
    Ds_Produto: TDataSource;
    Tab_Produto: TIBDataSet;
    DBEdit2: TDBLookupComboBox;
    DBEdit3: TDBLookupComboBox;
    Label8: TLabel;
    OpenDialog1: TOpenPictureDialog;
    SpeedButton1: TSpeedButton;
    DBGrid2: TDBGrid;
    SpeedButton2: TSpeedButton;
    Tab_ProdutoID_PRODUTO: TIntegerField;
    Tab_ProdutoID_FORNECEDOR: TIntegerField;
    Tab_ProdutoID_GRUPO: TIntegerField;
    Tab_ProdutoNOME_PRODUTO: TIBStringField;
    Tab_ProdutoVLCUSTO: TFloatField;
    Tab_ProdutoVLVENDA: TFloatField;
    Tab_ProdutoQTDESTOQUE: TIntegerField;
    Tab_ProdutoIMAGEM: TBlobField;
    Label1: TLabel;
    DBEdit1: TDBEdit;
    Label2: TLabel;
    Label3: TLabel;
    Label4: TLabel;
    DBEdit5: TDBEdit;
    Label5: TLabel;
    DBEdit6: TDBEdit;
    Label6: TLabel;
    DBEdit7: TDBEdit;
    Label7: TLabel;
    DBEdit8: TDBEdit;
    DBImage1: TDBImage;
    btn_fechar: TBitBtn;
    btn_excluir: TBitBtn;
    btn_alterar: TBitBtn;
    btn_incluir: TBitBtn;
    procedure habilita_botoes;
    procedure desabilita_botoes;
    procedure btn_incluirClick(Sender: TObject);
    procedure btn_alterarClick(Sender: TObject);
    procedure btn_cancelarClick(Sender: TObject);
    procedure btn_comfirmarClick(Sender: TObject);
    procedure FormActivate(Sender: TObject);
    procedure PageControl1Changing(Sender: TObject;
      var AllowChange: Boolean);
    procedure btn_excluirClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure BitBtn1Click(Sender: TObject);
    procedure Edit1Change(Sender: TObject);
    procedure FormKeyPress(Sender: TObject; var Key: Char);
    procedure DBImage1Click(Sender: TObject);
    procedure Trava_campos;
    procedure Destrava_campos;
    procedure Button1_VisualizarClick(Sender: TObject);
    procedure SpeedButton1Click(Sender: TObject);
    procedure SpeedButton2Click(Sender: TObject);
    procedure btn_fecharClick(Sender: TObject);
    procedure DBEdit6Exit(Sender: TObject);
    procedure DBEdit7Exit(Sender: TObject);
    procedure DBEdit8Exit(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form_Produto: TForm_Produto;

implementation

uses Unit_DM, Unit_Marca, Math;

{$R *.dfm}

procedure TForm_Produto.Habilita_botoes;
begin
 btn_incluir.enabled := True;
 btn_alterar.enabled := True;
 btn_excluir.enabled := True;
 btn_fechar.enabled := True;
end;

procedure TForm_Produto.Desabilita_botoes;
begin
 btn_incluir.enabled := False;
 btn_alterar.enabled := False;
 btn_excluir.enabled := False;
 btn_fechar.enabled := False;
end;
procedure TForm_Produto.btn_incluirClick(Sender: TObject);
begin
desabilita_botoes;
PageControl1.ActivePage := Tab_Cadastro;
Tab_Produto.Insert;

end;

procedure TForm_Produto.btn_alterarClick(Sender: TObject);
begin
desabilita_botoes;
PageControl1.ActivePage := Tab_Cadastro;
 Tab_Produto.Edit;
end;

procedure TForm_Produto.btn_cancelarClick(Sender: TObject);
begin
habilita_botoes;
PageControl1.ActivePage := Tab_Pesquisa;
Tab_Produto.Cancel;
Destrava_campos;
end;

procedure TForm_Produto.btn_comfirmarClick(Sender: TObject);
begin
  Try

    Tab_Produto.Post;
    DM.TBanco.CommitRetaining;
    ShowMessage('O registro foi gravado com sucesso!');
    Tab_Produto.Close;
    Tab_Produto.Open;

  Except
   DM.TBanco.Rollback;
   ShowMessage('Não foi possivel gravar dados!');
  Raise;
  end;
habilita_botoes;
PageControl1.ActivePage := Tab_Pesquisa;
end;

procedure TForm_Produto.FormActivate(Sender: TObject);
begin
PageControl1.ActivePage := Tab_Pesquisa;
end;

procedure TForm_Produto.PageControl1Changing(Sender: TObject;
  var AllowChange: Boolean);
begin
AllowChange:= False;
end;

procedure TForm_Produto.btn_excluirClick(Sender: TObject);
begin
if Application.MessageBox('Deseja Excluir o Produto selecionado ?','SOF CONTROL', MB_yesno + MB_Iconquestion) = Id_YES then begin
   Tab_Produto.Delete;
  end;

end;

procedure TForm_Produto.FormCreate(Sender: TObject);
begin
dm.Q_Grupo.Active :=true;
DM.Q_Fornecedor.close;
DM.Q_Fornecedor.Open;
dm.Q_Fornecedor.Last;
dm.Q_Fornecedor.First;

dm.Q_Grupo.Active :=true;
dm.Q_Grupo.Close;
dm.Q_Grupo.Open;
dm.Q_grupo.Last;
dm.Q_grupo.First;

Tab_Produto.Open;

end;

procedure TForm_Produto.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
Try
Tab_Produto.Close;
Tab_Produto.Open;
Tab_Produto.Close;
Except
ShowMessage('NÃO foi possivel fechar tabela Fornecedor!');
Raise;
end;
 end;
procedure TForm_Produto.BitBtn1Click(Sender: TObject);
begin
Application.CreateForm(TForm_Marca, Form_Marca);
Form_Marca.ShowModal;


end;

procedure TForm_Produto.Edit1Change(Sender: TObject);
begin
Case  Rg_tipo.ItemIndex of
0: Tab_Produto.Locate('id_produto', Edit1.Text, [ loPartialKey, loCaseInsensitive]);
1: Tab_Produto.Locate('nome_produto', Edit1.Text, [ loPartialKey, loCaseInsensitive]);
end;
end;

procedure TForm_Produto.FormKeyPress(Sender: TObject; var Key: Char);
begin
if  key = #13 then begin
    key := #0;
    Perform(WM_NEXTDLGCTL,0,0);
    end
    Else Exit;
end;

procedure TForm_Produto.DBImage1Click(Sender: TObject);
var
  bmp: TBitmap;
  jpg: TJPEGImage;
begin
   OpenDialog1.execute;
      // vamos criar o bitmap
    bmp := TBitmap.Create;
      // vamos criar o JPG
    jpg := TJPEGImage.Create;
    jpg.LoadFromFile(OpenDialog1.FileName);
    bmp.Assign(jpg);
    DBImage1.Picture.Bitmap := bmp;
end;

procedure TForm_Produto.Trava_campos;
begin
DBEdit1.Enabled := false;
DBEdit2.Enabled := False;
DBEdit5.Enabled := False;
DBEdit6.Enabled := False;
DBEdit7.Enabled := False;

btn_comfirmar.Enabled := False;
DBImage1.Enabled := False;
end;

procedure TForm_Produto.Destrava_campos;
begin
DBEdit1.Enabled := True;
DBEdit2.Enabled := True;
DBEdit5.Enabled := True;
DBEdit6.Enabled := True;
DBEdit7.Enabled := True;

btn_comfirmar.Enabled := True;
DBImage1.Enabled := True;
end;

procedure TForm_Produto.Button1_VisualizarClick(Sender: TObject);
begin
desabilita_botoes;
PageControl1.ActivePage := Tab_Cadastro;
Tab_Produto.Open;
btn_comfirmar.Enabled := False;
Trava_campos;
end;

procedure TForm_Produto.SpeedButton1Click(Sender: TObject);

var
  bmp: TBitmap;
  jpg: TJPEGImage;
begin
    OpenDialog1.execute;
      // vamos criar o bitmap
    bmp := TBitmap.Create;
      // vamos criar o JPG
    jpg := TJPEGImage.Create;
    jpg.LoadFromFile(OpenDialog1.FileName);
    bmp.Assign(jpg);
    DBImage1.Picture.Bitmap := bmp;


end;



procedure TForm_Produto.SpeedButton2Click(Sender: TObject);
begin
Tab_ProdutoIMAGEM.Clear;
DBImage1.Picture := nil;
end;

procedure TForm_Produto.btn_fecharClick(Sender: TObject);
begin
Close;
end;

procedure TForm_Produto.DBEdit6Exit(Sender: TObject);
begin
Tab_ProdutoVLCUSTO.currency := False;
if  (DBEdit6.Text <> '') then begin
  if StrToFloat(DBEdit6.Text) < 0 then begin
     ShowMessage('Informe um valor válido');
     DBEdit6.SetFocus;
     exit;
  end;
end;
Tab_ProdutoVLCUSTO.currency := True;



end;

procedure TForm_Produto.DBEdit7Exit(Sender: TObject);
begin
Tab_ProdutoVLVENDA.currency := False;
if  (DBEdit7.Text <> '') then begin
  if StrToFloat(DBEdit7.Text) < 0 then begin
     ShowMessage('Informe um valor válido');
     DBEdit7.SetFocus;
     exit;
  end;
end;
Tab_ProdutoVLVENDA.currency := True;
end;





procedure TForm_Produto.DBEdit8Exit(Sender: TObject);
begin
if  (DBEdit8.Text <> '') then begin
  if StrToFloat(DBEdit8.Text) < 0 then begin
     ShowMessage('Informe um valor válido');
     DBEdit8.SetFocus;
     exit;
  end;
end;
end;

end.
