unit Unit_Marca;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, Buttons, ExtCtrls, Grids, DBGrids, ComCtrls, DB,
  IBCustomDataSet, Mask, DBCtrls;

type
  TForm_Marca = class(TForm)
    PageControl1: TPageControl;
    Tab_Pesquisa: TTabSheet;
    Tab_Cadastro: TTabSheet;
    DBGrid1: TDBGrid;
    Rg_tipo: TRadioGroup;
    GroupBox1: TGroupBox;
    Edit1: TEdit;
    btn_comfirmar: TBitBtn;
    btn_cancelar: TBitBtn;
    Ds_Cidade: TDataSource;
    Tab_Cidade: TIBDataSet;
    Tab_CidadeID_GRUPO: TIntegerField;
    Tab_CidadeNOME_GRUPO: TIBStringField;
    Label1: TLabel;
    DBEdit1: TDBEdit;
    Label2: TLabel;
    DBEdit2: TDBEdit;
    btn_fechar: TBitBtn;
    btn_excluir: TBitBtn;
    btn_alterar: TBitBtn;
    btn_incluir: TBitBtn;
    procedure btn_fecharClick(Sender: TObject);
    procedure habilita_botoes;
    procedure desabilita_botoes;
    procedure btn_incluirClick(Sender: TObject);
    procedure btn_alterarClick(Sender: TObject);
    procedure btn_cancelarClick(Sender: TObject);
    procedure btn_comfirmarClick(Sender: TObject);
    procedure FormActivate(Sender: TObject);
    procedure PageControl1Changing(Sender: TObject;
      var AllowChange: Boolean);
    procedure btn_excluirClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure Edit1Change(Sender: TObject);
    procedure FormKeyPress(Sender: TObject; var Key: Char);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form_Marca: TForm_Marca;

implementation

uses Unit_DM;

{$R *.dfm}

procedure TForm_Marca.btn_fecharClick(Sender: TObject);
begin
Close;
Tab_Cidade.Close;
Tab_Cidade.Open;
end;

procedure TForm_Marca.Habilita_botoes;
begin
 btn_incluir.enabled := True;
 btn_alterar.enabled := True;
 btn_excluir.enabled := True;
 btn_fechar.enabled := True;
end;

procedure TForm_Marca.Desabilita_botoes;
begin
 btn_incluir.enabled := False;
 btn_alterar.enabled := False;
 btn_excluir.enabled := False;
 btn_fechar.enabled := False;
end;
procedure TForm_Marca.btn_incluirClick(Sender: TObject);
begin
desabilita_botoes;
PageControl1.ActivePage := Tab_Cadastro;
Tab_Cidade.Insert;
end;

procedure TForm_Marca.btn_alterarClick(Sender: TObject);
begin
desabilita_botoes;
PageControl1.ActivePage := Tab_Cadastro;
Tab_Cidade.Edit;
end;

procedure TForm_Marca.btn_cancelarClick(Sender: TObject);
begin
habilita_botoes;
PageControl1.ActivePage := Tab_Pesquisa;
Tab_Cidade.Cancel;
end;

procedure TForm_Marca.btn_comfirmarClick(Sender: TObject);
begin
  Try
    Tab_Cidade.Post;
    DM.TBanco.CommitRetaining;
    Tab_Cidade.Close;
    Tab_Cidade.Open;
    ShowMessage('O registro foi gravado com sucesso!');
  Except
   DM.TBanco.Rollback;
   ShowMessage('Não foi possivel gravar dados!');
  Raise;
  end;
habilita_botoes;
PageControl1.ActivePage := Tab_Pesquisa;
end;

procedure TForm_Marca.FormActivate(Sender: TObject);
begin
PageControl1.ActivePage := Tab_Pesquisa;
end;

procedure TForm_Marca.PageControl1Changing(Sender: TObject;
  var AllowChange: Boolean);
begin
AllowChange:= False;
end;

procedure TForm_Marca.btn_excluirClick(Sender: TObject);
begin
  if Application.MessageBox('Deseja Excluir a Cidade selecionada ?','SOF CONTROL', MB_yesno + MB_Iconquestion) = Id_YES then begin
   Tab_Cidade.Delete;
  end;
end;
procedure TForm_Marca.FormCreate(Sender: TObject);
begin
tab_cidade.Active := true;
Tab_Cidade.Open;
end;

procedure TForm_Marca.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
Try
Tab_Cidade.Close;
Except
ShowMessage('NÃO foi possivel fechar tabela Fornecedor!');
Raise;
end;
 end;
procedure TForm_Marca.Edit1Change(Sender: TObject);
begin
Case  Rg_tipo.ItemIndex of
0: Tab_Cidade.Locate('id_grupo', Edit1.Text, [ loPartialKey, loCaseInsensitive]);
1: Tab_Cidade.Locate('nome_grupo', Edit1.Text, [ loPartialKey, loCaseInsensitive]);
end;
end;
procedure TForm_Marca.FormKeyPress(Sender: TObject; var Key: Char);
begin
if  key = #13 then begin
    key := #0;
    Perform(WM_NEXTDLGCTL,0,0);
    end
    Else Exit;
end;

end.
