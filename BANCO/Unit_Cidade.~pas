unit Unit_Cidade;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, Buttons, ExtCtrls, Grids, DBGrids, ComCtrls, DB,
  IBCustomDataSet, Mask, DBCtrls;

type
  TForm_Cidade = class(TForm)
    PageControl1: TPageControl;
    Tab_Pesquisa: TTabSheet;
    Tab_Cadastro: TTabSheet;
    DBGrid1: TDBGrid;
    Rg_tipo: TRadioGroup;
    GroupBox1: TGroupBox;
    Edit1: TEdit;
    btn_comfirmar: TBitBtn;
    btn_cancelar: TBitBtn;
    Ds_Cidade: TDataSource;
    Tab_Cidade: TIBDataSet;
    Tab_CidadeID_CIDADE: TIntegerField;
    Tab_CidadeNOME_CIDADE: TIBStringField;
    Tab_CidadeID_ESTADO: TIntegerField;
    Label1: TLabel;
    DBEdit1: TDBEdit;
    Label2: TLabel;
    DBEdit2: TDBEdit;
    Label3: TLabel;
    Tab_Cidadeestado1: TStringField;
    DBLookupComboBox1: TDBLookupComboBox;
    btn_fechar: TBitBtn;
    btn_excluir: TBitBtn;
    btn_alterar: TBitBtn;
    btn_incluir: TBitBtn;
    procedure btn_fecharClick(Sender: TObject);
    procedure habilita_botoes;
    procedure desabilita_botoes;
    procedure btn_incluirClick(Sender: TObject);
    procedure btn_alterarClick(Sender: TObject);
    procedure btn_cancelarClick(Sender: TObject);
    procedure btn_comfirmarClick(Sender: TObject);
    procedure FormActivate(Sender: TObject);
    procedure PageControl1Changing(Sender: TObject;
      var AllowChange: Boolean);
    procedure btn_excluirClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure Edit1Change(Sender: TObject);
    procedure FormKeyPress(Sender: TObject; var Key: Char);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form_Cidade: TForm_Cidade;

implementation

uses Unit_DM;

{$R *.dfm}

procedure TForm_Cidade.btn_fecharClick(Sender: TObject);
begin
Close;
Tab_Cidade.Close;
Tab_Cidade.Open;
end;

procedure TForm_Cidade.Habilita_botoes;
begin
 btn_incluir.enabled := True;
 btn_alterar.enabled := True;
 btn_excluir.enabled := True;
 btn_fechar.enabled := True;
end;

procedure TForm_Cidade.Desabilita_botoes;
begin
 btn_incluir.enabled := False;
 btn_alterar.enabled := False;
 btn_excluir.enabled := False;
 btn_fechar.enabled := False;
end;
procedure TForm_Cidade.btn_incluirClick(Sender: TObject);
begin
desabilita_botoes;
PageControl1.ActivePage := Tab_Cadastro;
Tab_Cidade.Insert;
end;

procedure TForm_Cidade.btn_alterarClick(Sender: TObject);
begin
desabilita_botoes;
PageControl1.ActivePage := Tab_Cadastro;
Tab_Cidade.Edit;
end;

procedure TForm_Cidade.btn_cancelarClick(Sender: TObject);
begin
habilita_botoes;
PageControl1.ActivePage := Tab_Pesquisa;
Tab_Cidade.Cancel;
end;

procedure TForm_Cidade.btn_comfirmarClick(Sender: TObject);
begin
if DBEdit2.Text = '' then begin
    ShowMessage('Digite um nome de Cidade Válido!');
    DBEdit2.SetFocus;
    end;
if DBLookupComboBox1.Text = '' then begin
    ShowMessage('Selecione um Estado!');
    DBLookupComboBox1.SetFocus;
    end;

if (DBEdit2.Text > '') and (DBLookupComboBox1.Text > '') then begin
  Try
    Tab_Cidade.Post;
    DM.TBanco.CommitRetaining;
    Tab_Cidade.Close;
    Tab_Cidade.Open;
    ShowMessage('O registro foi gravado com sucesso!');
  Except
   DM.TBanco.Rollback;
   ShowMessage('Não foi possivel gravar dados!');
  Raise;
  end;

habilita_botoes;
PageControl1.ActivePage := Tab_Pesquisa;
end;
end;

procedure TForm_Cidade.FormActivate(Sender: TObject);
begin
PageControl1.ActivePage := Tab_Pesquisa;
end;

procedure TForm_Cidade.PageControl1Changing(Sender: TObject;
  var AllowChange: Boolean);
begin
AllowChange:= False;
end;

procedure TForm_Cidade.btn_excluirClick(Sender: TObject);
begin
  if Application.MessageBox('Deseja Excluir a Cidade selecionada ?','SOF CONTROL', MB_yesno + MB_Iconquestion) = Id_YES then begin
   Tab_Cidade.Delete;
  end;
end;
procedure TForm_Cidade.FormCreate(Sender: TObject);
begin
Tab_Cidade.Active := true;
Tab_Cidade.Open;
dm.Q_Estado.Active := true;
dm.Q_Estado.cLOSE;
dm.Q_Estado.Open;

dm.Q_Estado.Last;
dm.Q_Estado.First;

end;

procedure TForm_Cidade.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
Try
Tab_Cidade.Close;
Except
ShowMessage('NÃO foi possivel fechar tabela Fornecedor!');
Raise;
end;
 end;
procedure TForm_Cidade.Edit1Change(Sender: TObject);
begin
Case  Rg_tipo.ItemIndex of
0: Tab_Cidade.Locate('id_cidade', Edit1.Text, [ loPartialKey, loCaseInsensitive]);
1: Tab_Cidade.Locate('nome', Edit1.Text, [ loPartialKey, loCaseInsensitive]);
end;
end;
procedure TForm_Cidade.FormKeyPress(Sender: TObject; var Key: Char);
begin
if  key = #13 then begin
    key := #0;
    Perform(WM_NEXTDLGCTL,0,0);
    end
    Else Exit;
end;

end.
