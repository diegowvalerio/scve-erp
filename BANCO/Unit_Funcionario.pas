unit Unit_Funcionario;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, Buttons, ExtCtrls, Grids, DBGrids, ComCtrls, DB,
  IBCustomDataSet, Mask, DBCtrls, RxGIF;

type
  TForm_Usuario = class(TForm)
    PageControl1: TPageControl;
    Tab_Pesquisa: TTabSheet;
    Tab_Cadastro: TTabSheet;
    Rg_tipo: TRadioGroup;
    GroupBox1: TGroupBox;
    Edit1: TEdit;
    btn_comfirmar: TBitBtn;
    btn_cancelar: TBitBtn;
    Ds_Cliente: TDataSource;
    DBEdit14: TDBLookupComboBox;
    DBEdit13: TDBLookupComboBox;
    Image1: TImage;
    Image2: TImage;
    DBGrid2: TDBGrid;
    Tab_Cliente: TIBDataSet;
    Tab_ClienteID_FUNCIONARIO: TIntegerField;
    Tab_ClienteNOME: TIBStringField;
    Tab_ClienteENDERECO: TIBStringField;
    Tab_ClienteBAIRRO: TIBStringField;
    Tab_ClienteCEP: TIBStringField;
    Tab_ClienteDT_CADASTRO: TDateField;
    Tab_ClienteDT_NASC: TDateField;
    Tab_ClienteTELEFONE: TIBStringField;
    Tab_ClienteRG: TIBStringField;
    Tab_ClienteCPF: TIBStringField;
    Tab_ClienteSENHA: TIBStringField;
    Tab_ClienteLOGIN: TIBStringField;
    Tab_ClienteID_CIDADE: TIntegerField;
    Tab_ClienteID_ESTADO: TIntegerField;
    Label1: TLabel;
    DBEdit1: TDBEdit;
    Label2: TLabel;
    DBEdit2: TDBEdit;
    Label3: TLabel;
    DBEdit3: TDBEdit;
    Label4: TLabel;
    DBEdit4: TDBEdit;
    Label5: TLabel;
    DBEdit5: TDBEdit;
    Label6: TLabel;
    DBEdit6: TDBEdit;
    Label7: TLabel;
    DBEdit7: TDBEdit;
    Label8: TLabel;
    DBEdit8: TDBEdit;
    Label9: TLabel;
    DBEdit9: TDBEdit;
    Label10: TLabel;
    DBEdit10: TDBEdit;
    Label11: TLabel;
    DBEdit11: TDBEdit;
    Label12: TLabel;
    DBEdit12: TDBEdit;
    Label13: TLabel;
    Label14: TLabel;
    btn_fechar: TBitBtn;
    btn_excluir: TBitBtn;
    btn_alterar: TBitBtn;
    btn_incluir: TBitBtn;
    procedure btn_fecharClick(Sender: TObject);
    procedure habilita_botoes;
    procedure desabilita_botoes;
    procedure btn_incluirClick(Sender: TObject);
    procedure btn_alterarClick(Sender: TObject);
    procedure btn_cancelarClick(Sender: TObject);
    procedure btn_comfirmarClick(Sender: TObject);
    procedure FormActivate(Sender: TObject);
    procedure PageControl1Changing(Sender: TObject;
      var AllowChange: Boolean);
    procedure btn_excluirClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure Button1Click(Sender: TObject);
    procedure Trava_campos;
    procedure Destrava_campos;
    procedure Edit1Change(Sender: TObject);
    procedure DBEdit10Exit(Sender: TObject);



  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form_Usuario: TForm_Usuario;

implementation

uses Unit_DM, UnitMenu;

{$R *.dfm}

procedure TForm_Usuario.btn_fecharClick(Sender: TObject);
begin
Close;
end;




procedure TForm_Usuario.Habilita_botoes;
begin
 btn_incluir.enabled := True;
 btn_alterar.enabled := True;
 btn_excluir.enabled := True;
 btn_fechar.enabled := True;

end;

procedure TForm_Usuario.Trava_campos;
begin

DBEdit3.Enabled := False;
DBEdit4.Enabled := False;

DBEdit6.Enabled:= False;
DBEdit8.Enabled := False;
DBEdit2.Enabled := False;
DBEdit7.Enabled := False;
DBEdit5.Enabled := False;


end;
procedure TForm_Usuario.Destrava_campos;
begin

DBEdit3.Enabled := True;
DBEdit4.Enabled := True;

DBEdit6.Enabled:= True;
DBEdit8.Enabled := True;
DBEdit2.Enabled := True;
DBEdit7.Enabled := TRue;
DBEdit5.Enabled := True;


end;



procedure TForm_Usuario.Desabilita_botoes;
begin
 btn_incluir.enabled := False;
 btn_alterar.enabled := False;
 btn_excluir.enabled := False;
 btn_fechar.enabled := False;
end;
procedure TForm_Usuario.btn_incluirClick(Sender: TObject);
begin
desabilita_botoes;
PageControl1.ActivePage := Tab_Cadastro;
Tab_Cliente.Insert;


btn_comfirmar.Enabled := True;

Image1.Visible := False;
Image2.Visible := False;
end;

procedure TForm_Usuario.btn_alterarClick(Sender: TObject);
begin
desabilita_botoes;
PageControl1.ActivePage := Tab_Cadastro;
 Tab_Cliente.Edit;

 Image1.Transparent := True;
 Image2.Visible := False;
end;

procedure TForm_Usuario.btn_cancelarClick(Sender: TObject);
begin
habilita_botoes;
PageControl1.ActivePage := Tab_Pesquisa;
Tab_Cliente.Cancel;
Destrava_campos;
end;

procedure TForm_Usuario.btn_comfirmarClick(Sender: TObject);
begin
  Try
    Tab_Cliente.Post;
    DM.TBanco.CommitRetaining;
    Tab_Cliente.Close;
    Tab_Cliente.Open;
    ShowMessage('O registro foi gravado com sucesso!');
  Except
   DM.TBanco.Rollback;
   ShowMessage('Não foi possivel gravar dados!');
  Raise;
  end;
habilita_botoes;
PageControl1.ActivePage := Tab_Pesquisa;

end;

procedure TForm_Usuario.FormActivate(Sender: TObject);
begin
PageControl1.ActivePage := Tab_Pesquisa;
end;

procedure TForm_Usuario.PageControl1Changing(Sender: TObject;
  var AllowChange: Boolean);
begin
AllowChange:= False;
end;

procedure TForm_Usuario.btn_excluirClick(Sender: TObject);
begin
if Application.MessageBox('Deseja Excluir o Cliente selecionado ?','SOF CONTROL', MB_yesno + MB_Iconquestion) = Id_YES then begin
   Tab_Cliente.Delete;
  end;


end;

procedure TForm_Usuario.FormCreate(Sender: TObject);
begin
dm.Q_Cidade.Open;
Tab_Cliente.Open;

end;

procedure TForm_Usuario.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
Try
Tab_Cliente.Close;
Except
ShowMessage('NÃO foi possivel fechar tabela Tab_Cliente!');
Raise;
end;
 end;
procedure TForm_Usuario.Button1Click(Sender: TObject);
begin
desabilita_botoes;
PageControl1.ActivePage := Tab_Cadastro;
Tab_Cliente.Open;
btn_comfirmar.Enabled := False;
Trava_campos;
Image2.Visible := False;
Image1.Transparent := True;
end;

function Cpf(CPF_Text: string): boolean;
var n1,n2,n3,n4,n5,n6,n7,n8,n9: integer;
       d1,d2: integer;
       digitado, calculado: string;
begin
   n1:=StrToInt(CPF_Text[1]);
   n2:=StrToInt(CPF_Text[2]);
   n3:=StrToInt(CPF_Text[3]);
   n4:=StrToInt(CPF_Text[5]);
   n5:=StrToInt(CPF_Text[6]);
   n6:=StrToInt(CPF_Text[7]);
   n7:=StrToInt(CPF_Text[9]);
   n8:=StrToInt(CPF_Text[10]);
   n9:=StrToInt(CPF_Text[11]);
                     d1:=n9*2+n8*3+n7*4+n6*5+n5*6+n4*7+n3*8+n2*9+n1*10;
  d1:=11-(d1 mod 11);
   if d1>=10 then d1:=0;
        d2:=d1*2+n9*3+n8*4+n7*5+n6*6+n5*7+n4*8+n3*9+n2*10+n1*11;
    d2:=11-(d2 mod 11);
    if d2>=10 then
       d2:=0;
    calculado:=inttostr(d1)+inttostr(d2);
   digitado:=CPF_Text[13]+CPF_Text[14];
   if calculado=digitado then
       Cpf:=true
   else
       Cpf:=false;
end;

procedure TForm_Usuario.Edit1Change(Sender: TObject);
begin
Case  Rg_tipo.ItemIndex of
0: Tab_Cliente.Locate('id_cliente', Edit1.Text, [ loPartialKey, loCaseInsensitive]);
1: Tab_Cliente.Locate('nome', Edit1.Text, [ loPartialKey, loCaseInsensitive]);
end;
end;

procedure TForm_Usuario.DBEdit10Exit(Sender: TObject);
begin
if DBEdit10.Text > ''then begin

     If Cpf(DBEdit10.Text)=False Then
    Begin
      Image2.Transparent := True;
      Image2.Visible := True;
      Image1.Visible := False;
      MessageDlg('CPF informado é inválido!',mtError, [mbOk],0);
      DBEdit10.SetFocus;
    End;
    If Cpf(DBEdit10.Text)=True Then
    Begin
      Image2.Visible := False;
      Image1.Transparent := True;
      Image1.Visible := True;
    End;

end;
end;

end.
